<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mission Control | ResQWings</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <style>
    html, body { height: 100%; }
    #map { min-height: 500px; height: 100%; }
    .drone-marker { width: 18px; height: 18px; background: #10b981; border-radius: 50%; border: 2px solid #fff; box-shadow: 0 0 6px #10b981; }
  </style>
</head>
<body class="bg-gray-900 text-gray-100 min-h-screen">
  <header class="bg-black bg-opacity-80 backdrop-blur-sm w-full">
    <div class="container mx-auto px-4 py-3 flex justify-between items-center">
      <div class="flex items-center gap-2">
        <img src="https://opkrn.github.io/RESQWINGS/logoRq.png" alt="ResQWings Logo" class="h-8 w-auto">
        <span class="text-2xl font-bold text-emerald-400">ResQWings</span>
      </div>
      <nav class="flex gap-8 text-lg">
        <a href="#" class="hover:text-emerald-400 transition">Dashboard</a>
        <a href="#" class="hover:text-emerald-400 transition">Training</a>
        <a href="#" class="hover:text-emerald-400 transition">Documentation</a>
        <span class="ml-4 px-3 py-1 rounded-full bg-emerald-900 text-emerald-400 text-xs font-semibold">SWARM CONNECTED</span>
        <button class="ml-4 bg-emerald-500 hover:bg-emerald-600 text-white px-5 py-2 rounded-lg font-bold transition">Launch Mission</button>
      </nav>
    </div>
  </header>
  <main class="flex justify-center items-start py-10 min-h-[80vh]">
    <div class="w-full max-w-6xl bg-gray-900 rounded-xl shadow-2xl flex flex-col md:flex-row overflow-hidden">
      <!-- Sidebar -->
      <div class="w-full md:w-1/3 bg-gray-800 p-6 flex flex-col gap-6 min-w-[320px]">
        <div>
          <h2 class="text-lg font-semibold mb-2 text-white">Mission Parameters</h2>
          <input id="search" type="text" placeholder="Enter city / area / locality" class="w-full bg-gray-900 border border-gray-700 rounded-lg px-3 py-2 text-sm text-white mb-2 focus:outline-none focus:ring-2 focus:ring-emerald-500">
          <button id="searchBtn" class="w-full bg-emerald-500 hover:bg-emerald-600 text-white py-2 rounded-lg font-semibold mb-2 flex items-center justify-center gap-2"><span>üîç</span>Search</button>
          <select id="droneCount" class="w-full bg-gray-900 border border-gray-700 rounded-lg px-3 py-2 text-sm mt-2 mb-2 text-white focus:outline-none focus:ring-2 focus:ring-emerald-500">
          </select>
          <button id="resetBtn" class="bg-gray-700 hover:bg-gray-600 text-white px-4 py-2 rounded-lg font-medium transition w-full mt-2">Reset</button>
        </div>
        <div>
          <h2 class="text-lg font-semibold mb-2 text-white">Swarm Status</h2>
          <div class="flex flex-col gap-1 text-sm text-gray-300">
            <div class="flex justify-between"><span>Active Drones</span><span id="active-drones-count">1/1</span></div>
            <div class="flex justify-between"><span>Average Battery</span><span>84%</span></div>
            <div class="flex justify-between"><span>Network Latency</span><span class="text-emerald-400">28ms</span></div>
            <div class="flex justify-between"><span>Area Covered</span><span id="area-covered">0%</span></div>
          </div>
        </div>
      </div>
      <!-- Map -->
      <div class="w-full md:w-2/3 relative min-h-[500px]">
        <div id="map" class="rounded-none md:rounded-r-xl absolute inset-0"></div>
      </div>
    </div>
  </main>
  <script>
    // Generate drone count options 1-100
    const droneCountSelect = document.getElementById('droneCount');
    for(let i=1;i<=100;i++){
      const opt = document.createElement('option');
      opt.value = i;
      opt.textContent = `${i} Drone${i>1?'s':''}`;
      droneCountSelect.appendChild(opt);
    }
    // Map setup
    var map = L.map('map').setView([20, 30], 2);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 19,
      attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);
    let droneMarkers = [];
    let areaRect = null;
    // Search and scan logic
    document.getElementById('searchBtn').onclick = async function() {
      const query = document.getElementById('search').value.trim();
      if(!query) return alert('Enter a location');
      const res = await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(query)}`);
      const data = await res.json();
      if(!data.length) return alert('Location not found');
      const {lat, lon, boundingbox} = data[0];
      const bounds = [
        [parseFloat(boundingbox[0]), parseFloat(boundingbox[2])],
        [parseFloat(boundingbox[1]), parseFloat(boundingbox[3])]
      ];
      if(areaRect) map.removeLayer(areaRect);
      areaRect = L.rectangle(bounds, {color:'#10b981',weight:2,fillOpacity:0.1}).addTo(map);
      map.fitBounds(bounds);
      // Start drone scan
      startDroneScan(bounds);
    };
    function startDroneScan(bounds) {
      // Remove old markers
      droneMarkers.forEach(m=>map.removeLayer(m));
      droneMarkers = [];
      const numDrones = parseInt(droneCountSelect.value);
      document.getElementById('active-drones-count').textContent = `${numDrones}/${numDrones}`;
      document.getElementById('area-covered').textContent = '0%';
      // Distribute drones along the top edge
      const [lat1, lng1] = bounds[0];
      const [lat2, lng2] = bounds[1];
      for(let i=0;i<numDrones;i++){
        const frac = i/(numDrones-1||1);
        const lat = lat1;
        const lng = lng1 + frac*(lng2-lng1);
        const marker = L.marker([lat,lng], {
          icon: L.divIcon({className:'drone-marker'})
        }).addTo(map);
        droneMarkers.push(marker);
      }
      // Animate drones scanning down
      let progress = 0;
      const totalSteps = 100;
      function animate() {
        progress++;
        for(let i=0;i<droneMarkers.length;i++){
          const frac = i/(numDrones-1||1);
          const lat = lat1 + (lat2-lat1)*(progress/totalSteps);
          const lng = lng1 + frac*(lng2-lng1);
          droneMarkers[i].setLatLng([lat,lng]);
        }
        document.getElementById('area-covered').textContent = Math.min(Math.round((progress/totalSteps)*100),100)+"%";
        if(progress<totalSteps) requestAnimationFrame(animate);
      }
      animate();
    }
    document.getElementById('resetBtn').onclick = function() {
      if(areaRect) map.removeLayer(areaRect);
      droneMarkers.forEach(m=>map.removeLayer(m));
      droneMarkers = [];
      document.getElementById('area-covered').textContent = '0%';
      document.getElementById('active-drones-count').textContent = '1/1';
      map.setView([20, 30], 2);
    };
  </script>
</body>
</html>
